---
lab:
    title: '연습 2 - 데이터 커넥터를 사용하여 Microsoft Sentinel에 Windows 디바이스 연결'
    module: '모듈 6 - Microsoft Sentinel에 로그 연결'
---

# 모듈 6 - 랩 1 - 연습 2 - 데이터 커넥터를 사용하여 Microsoft Sentinel에 Windows 디바이스 연결


### 작업 1: Azure에서 Windows 가상 머신 만들기

이 작업에서는 Azure에서 Windows 가상 머신을 만듭니다.

1. WIN1 가상 머신에 Admin으로 로그인합니다. 암호로는 **Pa55w.rd**를 사용합니다.  

2. Edge 브라우저에서 Azure Portal https://portal.azure.com 으로 이동합니다.

3. 랩 호스팅 공급자가 제공한 **테넌트 전자 메일** 계정을 복사하여 **로그인** 대화 상자에 붙여 넣은 후 **다음**을 선택합니다.

4. 랩 호스팅 공급자가 제공한 **테넌트 암호**를 복사하여 **암호 입력** 대화 상자에 붙여 넣은 후 **로그인**을 선택합니다.

5. **+ 리소스 만들기**를 선택합니다. 이미 Azure Portal에 있다면 상단 표시줄에서 *Microsoft Azure*를 선택하여 홈으로 돌아가야 할 수 있습니다.

6. **서비스 및 마켓플레이스 검색** 상자에 *Windows 10*을 입력합니다. 

7. *Microsoft Windows 10*에 대해 **만들기** 드롭다운을 선택합니다.  그런 다음 **Windows 10 Enterprise, 버전 20H2**를 선택합니다.

8. 구독을 선택합니다.

9. *리소스 그룹*에서 **새로 만들기**를 선택하고 이름으로 RG-AZWIN01을 입력한 후 **확인**을 선택합니다.

    >**참고:** 추적을 위한 새 리소스 그룹이어야 합니다.  

10. *가상 머신 이름*에 AZWIN01을 입력합니다.

11. *지역*을 현재 위치에 적합한 지역으로 설정합니다.  적절한 지역이 기본으로 설정됩니다.

12. *가용성 옵션*으로 **인프라 중복 필요 없음**을 선택합니다.

12. Azure에 적합한 원하는 *사용자 이름*을 입력합니다.

13. 원하는 *암호*를 입력합니다. 

    >**힌트:** 테넌트 암호를 사용하는 것이 가장 간편할 수 있습니다.

14. *라이선스* 아래의 체크박스를 선택합니다.

15. **검토 + 만들기**를 선택합니다.

16. **만들기**를 선택합니다. 리소스가 작성될 때까지 기다립니다. 몇 분 정도 걸릴 수 있습니다.


### 작업 2: Azure Windows 가상 머신을 연결합니다.

이 작업에서는 Microsoft Sentinel에 Azure Windows 가상 머신을 연결합니다.

1. Azure Portal의 검색 창에 *Sentinel*을 입력하고 **Microsoft Sentinel**을 선택합니다.

2. 앞에서 만든 Microsoft Sentinel 작업 영역을 선택합니다.

3. 데이터 커넥터 탭에서 **레거시 에이전트를 통한 보안 이벤트** 커넥터를 검색하고 목록에서 선택합니다.

4. 커넥터 정보 블레이드에서 **커넥터 페이지 열기**를 선택합니다.

5. **Azure Windows 가상 머신에 에이전트 설치** 옵션을 선택합니다.

6. **Azure Windows 가상 머신용 에이전트 다운로드 및 설치**를 선택합니다.

7. 목록에서 이전 작업에서 방금 만든 **AZWIN01** 가상 머신을 선택한 다음 **연결**을 선택합니다. *연결...* 메시지가 표시될 때까지 기다립니다.

8. 'x'를 선택하여 창을 닫고 **가상 머신** 뷰로 돌아갑니다. 이제 가상 머신에 "이 작업 영역"에 대한 *Log Analytics가 연결*이 표시되는 것을 확인할 수 있습니다.


### 작업 3: Azure 이외의 Windows 컴퓨터 연결

이 작업에서는 Microsoft Sentinel에 Azure 이외의 Windows 가상 머신을 연결합니다.

1. WIN2 가상 머신에 Admin으로 로그인합니다. 암호로는 **Pa55w.rd**를 사용합니다.  

2. Microsoft Edge 브라우저를 엽니다.

3. 브라우저를 열고 이전 랩에서 사용했던 자격 증명으로 Azure Portal(https://portal.azure.com) 에 로그인합니다.

4. Azure Portal의 검색 창에 *Sentinel*을 입력하고 **Microsoft Sentinel**을 선택합니다.

5. Microsoft Sentinel 작업 영역을 선택합니다.

6. **데이터 커넥터**를 선택한 후 **레거시 에이전트를 통한 보안 이벤트** 커넥터를 검색하고 목록에서 선택합니다.

7. 커넥터 정보 블레이드에서 **커넥터 페이지 열기**를 선택합니다.

8. 스트리밍할 이벤트 선택 영역에서 **모든 이벤트**를 선택하고 **변경 내용 적용**을 선택합니다.

9. **Azure 이외의 Windows 컴퓨터에 에이전트 설치**를 선택합니다.

10. **Azure Windows 이외의 머신용 에이전트 다운로드 및 설치**를 선택합니다. 

11. **Windows 에이전트 다운로드(64비트)** 링크를 선택합니다.

12. 다운로드한 *MMASetup-AMD64.exe* 파일을 열고 **예**를 선택하여 표시되는 사용자 계정 컨트롤 창에서 실행 파일을 실행하도록 허용합니다.

13. 시작 대화 상자에서 **다음**을 선택합니다.

14. Microsoft 소프트웨어 사용 조건 페이지에서 **동의**를 선택합니다.  대상 선택 메시지에서 **다음**을 선택합니다.

15. 에이전트 설치 옵션 메시지에서 **Azure Log Analytics(OMS)에 에이전트 연결** 옵션을 선택한 후 **다음**을 선택합니다.

16. Microsoft Sentinel이 열려 있는 브라우저의 에이전트 관리 페이지에서 **작업 영역 ID**를 복사하여 대화 상자에 있는 작업 영역 ID에 붙여 넣습니다. 

17. Microsoft Sentinel이 열려 있는 브라우저의 에이전트 관리 페이지에서 **기본 키**를 복사하여 대화 상자에 있는 작업 영역 키에 붙여 넣습니다. 

18. **다음**을 선택합니다.

19. Microsoft 업데이트 페이지에서 **다음**을 선택합니다.

20. 그런 다음 **설치**를 선택합니다.  완료되면 **마침**을 선택합니다.


### 작업 4: Sysmon 설치 및 로그 수집

이 작업에서는 Sysmon을 설치하여 Sysmon 로그를 수집합니다.

>**중요:** WIN2 가상 머신에 연결되어 있어야 합니다. 다음 지침에 따라 작업을 수행하면 기본 구성으로 Sysmon이 설치됩니다. 프로덕션 컴퓨터에서 Sysmon을 사용하려면 커뮤니티에서 제공되는 구성을 조사해야 합니다.

1. 브라우저에서 새 탭을 열고https://docs.microsoft.com/sysinternals/downloads/sysmon 으로 이동합니다.

2. **Download Sysmon**을 선택하여 해당 페이지에서 Sysmon을 다운로드합니다.

3. *Sysmon.zip*을 커서로 가리키고 폴더 아이콘을 선택합니다. 다운로드한 파일을 마우스 오른쪽 단추로 클릭하고 **압축 풀기...** 를 선택합니다. **압축을 풀어서 다음 폴더에 저장** 아래에서 *C:\Sysmon*을 입력하고 **압축 풀기**를 선택합니다. 

4. WIN2의 Windows 작업 표시줄 검색 창에 *명령*을 입력합니다.  검색 결과에 명령 프롬프트 앱이 표시됩니다.  명령 프롬프트 앱을 마우스 오른쪽 단추로 클릭하고 **관리자 권한으로 실행**을 선택합니다.  **예**를 선택하여 표시되는 사용자 계정 컨트롤 창에서 앱을 실행하도록 허용합니다.

5. *cd \sysmon*을 입력합니다.

6. *notepad sysmon.xml*을 입력하여 새 파일을 만듭니다. **예**를 선택하여 파일 만들기를 확인합니다.

7. 브라우저에서 새 탭을 열고 https://github.com/SwiftOnSecurity/sysmon-config/blob/master/sysmonconfig-export.xml 로 이동합니다.

8. **Raw** 단추를 선택하고 GitHub의 해당 파일 내용을 방금 만든 sysmon.xml 메모장 파일에 복사합니다. **파일**, **저장**을 차례로 선택하여 파일을 저장합니다.

9. 명령 프롬프트에 다음 명령을 입력하고 Enter 키를 누릅니다.
    **sysmon.exe -accepteula -i sysmon.xml**

    >**참고:**  출력에 "Configuration file validated" 및 "Sysmon started" 메시지가 나타나는지 확인합니다. 그렇지 않은 경우 데이터가 제대로 복사되었고 sysmon.xml이 저장되었는지 확인합니다.

10. 브라우저에서 Azure Portal(https://portal.azure.com) 로 이동합니다. 

11. Azure Portal의 검색 창에 *Sentinel*을 입력하고 **Microsoft Sentinel**을 선택한 다음 앞에서 만든 Microsoft Sentinel 작업 영역을 선택합니다.

12. Microsoft Sentinel의 구성 영역에서 **설정**을 선택한 다음 **작업 영역 설정 >** 탭을 선택합니다.

13. Microsoft Sentinel 작업 영역이 선택되어 있는지 확인합니다.

14. 설정 영역에서 **에이전트 구성**을 선택합니다.

15. **Windows 이벤트 로그** 탭을 선택합니다.

16. **Windows 이벤트 로그 추가** 단추를 선택합니다.

17. 로그 이름 필드에 **Microsoft-Windows-Sysmon/Operational**을 입력합니다.

18. **적용**을 선택합니다.


### 작업 5: 엔드포인트용 Microsoft Defender 디바이스 온보딩

이 작업에서는 엔드포인트용 Microsoft Defender에 디바이스를 온보딩합니다.

>**중요:** 이 과정의 첫 번째 모듈에서 랩을 완료했고 가상 머신을 저장했다면 이 작업을 이미 수행한 것입니다. 이는 랩 연습에서 동일한 가상 머신을 사용하는 경우 이 작업을 건너뛸 수 있음을 의미합니다.

1. WIN1 가상 머신에 Admin으로 로그인합니다. 암호로는 **Pa55w.rd**를 사용합니다.  

2. Edge 브라우저에서 Microsoft 365 Defender 포털(https://security.microsoft.com) 로 이동하여 **테넌트 전자 메일** 자격 증명으로 로그인합니다(현재 포털에 없는 경우).

3. 왼쪽 메뉴 모음에서 **설정**을 선택한 다음 설정 페이지에서 **엔드포인트**를 선택합니다.

4. 디바이스 관리 섹션에서 **온보딩**을 선택합니다.

5. **패키지 다운로드**를 선택합니다.

6. 다운로드한 .zip 파일의 압축을 풉니다.

7. Windows 명령 프롬프트를 **관리자** 권한으로 실행합니다. 사용자 계정 컨트롤 메시지가 표시되면 실행에 동의합니다.

8. 방금 관리자 권한으로 압축을 푼 WindowsDefenderATPLocalOnboardingScript.cmd 파일을 실행합니다. **참고** 이 파일의 기본 위치는 c:\users\admin\downloads 디렉터리입니다. 스크립트에서 표시되는 질문에 답변으로 Y 키를 누릅니다. 

9. 포털의 온보딩 페이지에서 검색 테스트 스크립트를 복사한 다음 열린 명령 창에서 실행합니다.  새 **관리자: 명령 프롬프트** 창을 열어야 할 수도 있습니다. 이 창을 열려면 Windows 검색 창에 *CMD*를 입력하고 **관리자 권한으로 실행**을 선택합니다.

10. 엔드포인트 영역의 Microsoft 365 Defender 포털에서 **디바이스 인벤토리**를 선택합니다. 이제 목록에 디바이스가 표시됩니다.

## 연습 3 계속 진행
